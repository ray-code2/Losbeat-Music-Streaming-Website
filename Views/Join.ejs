<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="Images/logo.png" type="image/gif" sizes="16x16">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="stylelogin.css" rel="Stylesheet">
</head>
<script defer src="signin.js"></script>
<body>
    <header class="navigation">
        <a href="/" class="brand-logo">
            <img src="Images/logo.png">
            <div class="brand-logo-name">LOSBEATS</div>
            </a>
        </div>
      
    </header>
    <main>
        <form class="login" id="form">
            <div class="textbox">
                <p>Username</p>
                <input id="username"type="text" placeholder="Enter Username" name="username" required>
                <div class="username error"></div>
                <p>Password</p>
                <input type="password" placeholder="Enter Password" name="password" required>
                <div class="password error"></div>
            </div>
            
            <button id= "submit" class="btn"> Sign in </button>
            
            <a href="/forgotpassword">
                <input class="btn" type="button" value="Forgot Password?">
            </a>
            <a href="/create">
                <input class="btn" type="button" value="Don't Have an Account?">
            </a>
           

        </form>
        </main>
<script>
    const form = document.querySelector('form');
    const passwordError = document.querySelector('.password.error')
    const usernameError = document.querySelector('.username.error')
    form.addEventListener('submit' , async(e) => {
        e.preventDefault();
            // reset errors
        usernameError.textContent = '';
        passwordError.textContent = '';
        const username = form.username.value;
        const password = form.password.value;
        try {
            const res = await fetch('/login' , {
                method: 'POST',
                body: JSON.stringify({
                   username , password
                }),
                headers: {'Content-Type': 'application/json'}

            })
            const data = await res.json();
            console.log(data);
            if(data.errors) {
             usernameError.textContent = data.errors.username;
             passwordError.textContent = data.errors.password;
            }
            if(data.user) {
                location.assign('/homepage')
            }
        } catch (err) {
            console.log(err)
        }

    })
  
</script>

</body>
</html>
